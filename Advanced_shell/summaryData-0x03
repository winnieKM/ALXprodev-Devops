#!/bin/bash

# Output CSV file
output_file="pokemon_report.csv"

# Header row
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Loop through all JSON files in pokemon_data/
for file in pokemon_data/*.json
do
  # Use local jq to parse
  name=$(./jq -r '.name' "$file" | sed 's/.*/\u&/')
  height=$(./jq -r '.height' "$file")
  weight=$(./jq -r '.weight' "$file")

  # Convert to meters and kg
  height_m=$(awk "BEGIN {printf \"%.2f\", $height / 10}")
  weight_kg=$(awk "BEGIN {printf \"%.2f\", $weight / 10}")

  # Append row to CSV
  echo "$name,$height_m,$weight_kg" >> "$output_file"
done

echo
echo "CSV Report generated at: $output_file"
echo

# Show report
cat "$output_file"

# Calculate averages
avg_height=$(awk -F',' 'NR>1 {sum+=$2} END {printf "%.2f", sum/(NR-1)}' "$output_file")
avg_weight=$(awk -F',' 'NR>1 {sum+=$3} END {printf "%.2f", sum/(NR-1)}' "$output_file")

echo
echo "Average Height: $avg_height m"
echo "Average Weight: $avg_weight kg"
